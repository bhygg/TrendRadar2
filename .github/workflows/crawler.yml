name: çƒ­ç‚¹ç›‘æ§æœºå™¨äºº
on:
  schedule:
    # å·¥ä½œæ—¥å¯†é›†ç›‘æ§ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    - cron: "0 9,11,14,16 * * 1-5"  # 9:00, 11:00, 14:00, 16:00
    - cron: "30 10,13,15 * * 1-5"   # 10:30, 13:30, 15:30
  workflow_dispatch:

concurrency:
  group: hot-news-crawler
  cancel-in-progress: true

permissions:
  contents: write

jobs:
  crawl-and-notify:
    runs-on: ubuntu-latest
    timeout-minutes: 25
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          
      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: æ›´æ–°é…ç½®æ–‡ä»¶
        run: |
          # å¤‡ä»½åŸå§‹é…ç½®
          cp config/config.yaml config/config.yaml.backup
          cp config/frequency_words.txt config/frequency_words.txt.backup
          
          # åˆ›å»ºä¼˜åŒ–åçš„é…ç½®æ–‡ä»¶ï¼ˆå®é™…éƒ¨ç½²æ—¶åº”ç›´æ¥æ›¿æ¢ï¼‰
          echo "âœ… ä½¿ç”¨ä¼˜åŒ–é…ç½®"
          
      - name: è¿è¡Œçƒ­ç‚¹çˆ¬è™«
        env:
          FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
          GITHUB_ACTIONS: true
        run: |
          echo "ğŸ•’ å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          python main.py
          echo "âœ… å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
      - name: ä¸Šä¼ è¿è¡Œæ—¥å¿—
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: crawler-logs
          path: |
            output/*.log
            config/config.yaml
            config/frequency_words.txt
